<form id="feedbackForm" novalidate>
  <label>Full Name
    <input id="fullName" name="fullName" type="text" required minlength="2" />
  </label>
  <label>Email Address
    <input id="email" name="email" type="email" required />
  </label>
  <label>Feedback
    <textarea id="message" name="message" required minlength="5" rows="5"></textarea>
  </label>
  <button id="submitBtn" type="submit">Submit</button>
  <p id="formMsg" role="status" aria-live="polite"></p>
</form>

<script>
  const form = document.getElementById("feedbackForm");
  const btn = document.getElementById("submitBtn");
  const msg = document.getElementById("formMsg");

  const setMsg = (t, ok = false) => {
    msg.textContent = t;
    msg.style.color = ok ? "#18a957" : "#e23d3d";
  };

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const body = {
      fullName: document.getElementById("fullName").value.trim(),
      email: document.getElementById("email").value.trim(),
      message: document.getElementById("message").value.trim(),
    };
    if (!body.fullName || !body.email || !body.message) {
      return setMsg("Please fill in all fields");
    }

    btn.disabled = true;
    setMsg("Submittingâ€¦");

    try {
      const res = await fetch("/api/feedback", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });
      if (!res.ok) throw new Error(await res.text());
      setMsg("Submitted successfully, thank you for your feedback!", true);
      form.reset();
    } catch (err) {
      setMsg("Failed to submit: " + err.message);
    } finally {
      btn.disabled = false;
    }
  });
</script>
